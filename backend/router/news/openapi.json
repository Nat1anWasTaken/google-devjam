{
  "openapi": "3.0.3",
  "info": {
    "title": "Google DevJam Backend - News API",
    "description": "Personalized news generation and retrieval endpoints for English language learners",
    "version": "1.0.0",
    "contact": {
      "name": "API Support"
    }
  },
  "servers": [
    {
      "url": "http://localhost:8080",
      "description": "Development server"
    }
  ],
  "paths": {
    "/news/generate": {
      "post": {
        "tags": ["News Generation"],
        "summary": "Generate personalized news",
        "description": "Generate personalized news articles based on user preferences and vocabulary. If user has less than 4 articles, generates enough to reach 4 total. If user has 4+ articles and no news generated within the last 4 hours, generates 4 new articles.",
        "operationId": "generateNews",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Existing news returned (generated within last 4 hours)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GenerateNewsResponse"
                },
                "example": {
                  "all_news": [
                    {
                      "id": "1234567890123456789",
                      "user_id": "1234567890123456788",
                      "title": "Technology Advances in Artificial Intelligence",
                      "content": "Artificial intelligence continues to evolve rapidly, transforming industries and creating new opportunities for innovation...",
                      "level": 2,
                      "keywords": ["technology", "artificial", "intelligence", "innovation", "machine learning"],
                      "word_in_news": ["computer", "software", "develop", "system", "technology"],
                      "source": ["Generated by AI", "Personalized Learning Content"],
                      "created_at": "2024-01-15T10:30:00Z",
                      "updated_at": "2024-01-15T10:30:00Z"
                    }
                  ]
                }
              }
            }
          },
          "201": {
            "description": "New news generated successfully (4 articles every 4 hours)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GenerateNewsResponse"
                },
                "example": {
                  "all_news": [
                    {
                      "id": "1234567890123456790",
                      "user_id": "1234567890123456788",
                      "title": "Climate Change Solutions Through Green Technology",
                      "content": "Scientists and engineers around the world are developing innovative solutions to combat climate change...",
                      "level": 2,
                      "keywords": ["climate", "technology", "renewable", "energy", "environment"],
                      "word_in_news": ["develop", "system", "energy", "environment", "solution"],
                      "source": ["Generated by AI", "Personalized Learning Content"],
                      "created_at": "2024-01-15T14:30:00Z",
                      "updated_at": "2024-01-15T14:30:00Z"
                    },
                    {
                      "id": "1234567890123456791",
                      "user_id": "1234567890123456788",
                      "title": "Advances in Space Exploration Technology",
                      "content": "Recent developments in rocket technology and satellite systems have opened new possibilities for space exploration...",
                      "level": 2,
                      "keywords": ["space", "technology", "exploration", "satellite", "rocket"],
                      "word_in_news": ["technology", "system", "develop", "explore", "advance"],
                      "source": ["Generated by AI", "Personalized Learning Content"],
                      "created_at": "2024-01-15T14:31:00Z",
                      "updated_at": "2024-01-15T14:31:00Z"
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "User not authenticated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "User not authenticated"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "vocabulary_error": {
                    "summary": "Failed to get user vocabulary",
                    "value": {
                      "error": "Failed to get user vocabulary: Database connection error"
                    }
                  },
                  "gemini_error": {
                    "summary": "Failed to generate news",
                    "value": {
                      "error": "Failed to generate news: Gemini API error"
                    }
                  },
                  "database_error": {
                    "summary": "Database connection error",
                    "value": {
                      "error": "Database connection error"
                    }
                  },
                  "storage_error": {
                    "summary": "Failed to store news",
                    "value": {
                      "error": "Failed to store news: Database write error"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/news/force-generate": {
      "post": {
        "tags": ["News Generation"],
        "summary": "Force generate 4 new news articles",
        "description": "Force generate 4 new personalized news articles based on user preferences and vocabulary, regardless of existing news or timing constraints. Always generates exactly 4 new articles.",
        "operationId": "forceGenerateNews",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "201": {
            "description": "4 new news articles generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GenerateNewsResponse"
                },
                "example": {
                  "all_news": [
                    {
                      "id": "1234567890123456792",
                      "user_id": "1234567890123456788",
                      "title": "Revolutionary Advances in Medical Technology",
                      "content": "Medical researchers have made significant breakthroughs in developing new treatments and diagnostic tools...",
                      "level": 2,
                      "keywords": ["medical", "technology", "research", "treatment", "healthcare"],
                      "word_in_news": ["develop", "system", "research", "medical", "technology"],
                      "source": ["Generated by AI", "Personalized Learning Content"],
                      "created_at": "2024-01-15T15:30:00Z",
                      "updated_at": "2024-01-15T15:30:00Z"
                    },
                    {
                      "id": "1234567890123456793",
                      "user_id": "1234567890123456788",
                      "title": "Sustainable Transportation Solutions",
                      "content": "Cities around the world are implementing innovative transportation systems to reduce environmental impact...",
                      "level": 2,
                      "keywords": ["transportation", "sustainability", "environment", "innovation"],
                      "word_in_news": ["system", "develop", "environment", "transport", "solution"],
                      "source": ["Generated by AI", "Personalized Learning Content"],
                      "created_at": "2024-01-15T15:31:00Z",
                      "updated_at": "2024-01-15T15:31:00Z"
                    },
                    {
                      "id": "1234567890123456794",
                      "user_id": "1234567890123456788",
                      "title": "Educational Technology Transformation",
                      "content": "Digital learning platforms are revolutionizing how students access and interact with educational content...",
                      "level": 2,
                      "keywords": ["education", "technology", "digital", "learning", "students"],
                      "word_in_news": ["technology", "system", "develop", "education", "digital"],
                      "source": ["Generated by AI", "Personalized Learning Content"],
                      "created_at": "2024-01-15T15:32:00Z",
                      "updated_at": "2024-01-15T15:32:00Z"
                    },
                    {
                      "id": "1234567890123456795",
                      "user_id": "1234567890123456788",
                      "title": "Smart City Infrastructure Development",
                      "content": "Urban planners are integrating smart technologies into city infrastructure to improve efficiency and quality of life...",
                      "level": 2,
                      "keywords": ["smart city", "infrastructure", "technology", "urban", "development"],
                      "word_in_news": ["develop", "system", "technology", "infrastructure", "smart"],
                      "source": ["Generated by AI", "Personalized Learning Content"],
                      "created_at": "2024-01-15T15:33:00Z",
                      "updated_at": "2024-01-15T15:33:00Z"
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "User not authenticated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "User not authenticated"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "vocabulary_error": {
                    "summary": "Failed to get user vocabulary",
                    "value": {
                      "error": "Failed to get user vocabulary: Database connection error"
                    }
                  },
                  "gemini_error": {
                    "summary": "Failed to generate news",
                    "value": {
                      "error": "Failed to generate news: Gemini API error"
                    }
                  },
                  "database_error": {
                    "summary": "Database connection error",
                    "value": {
                      "error": "Database connection error"
                    }
                  },
                  "storage_error": {
                    "summary": "Failed to store news",
                    "value": {
                      "error": "Failed to store news: Database write error"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/news": {
      "get": {
        "tags": ["News Retrieval"],
        "summary": "Get news articles",
        "description": "Retrieve user's generated news articles with pagination, filtering by level, and search functionality. Only returns news generated by the authenticated user.",
        "operationId": "getNews",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Page number for pagination (default: 1)",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            },
            "example": 1
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Number of items per page (default: 10, max: 50)",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 50,
              "default": 10
            },
            "example": 10
          },
          {
            "name": "level",
            "in": "query",
            "description": "Filter by learning level",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["beginner", "intermediate", "advanced"]
            },
            "example": "intermediate"
          },
          {
            "name": "search",
            "in": "query",
            "description": "Search in title, content, or keywords",
            "required": false,
            "schema": {
              "type": "string"
            },
            "example": "technology"
          }
        ],
        "responses": {
          "200": {
            "description": "News articles retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetNewsResponse"
                },
                "example": {
                  "news": [
                    {
                      "id": "1234567890123456789",
                      "user_id": "1234567890123456788",
                      "title": "Technology Advances in Artificial Intelligence",
                      "content": "Artificial intelligence continues to evolve rapidly...",
                      "level": "intermediate",
                      "keywords": ["technology", "artificial", "intelligence", "innovation"],
                      "word_in_news": ["computer", "software", "develop", "system"],
                      "source": ["Generated by AI", "Personalized Learning Content"],
                      "created_at": "2024-01-15T10:30:00Z",
                      "updated_at": "2024-01-15T10:30:00Z"
                    }
                  ],
                  "total": 1,
                  "page": 1,
                  "limit": 10
                }
              }
            }
          },
          "401": {
            "description": "User not authenticated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "User not authenticated"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "examples": {
                  "database_error": {
                    "summary": "Database connection error",
                    "value": {
                      "error": "Database connection error"
                    }
                  },
                  "query_error": {
                    "summary": "Database query error",
                    "value": {
                      "error": "Database error"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/news/{id}": {
      "get": {
        "tags": ["News Retrieval"],
        "summary": "Get specific news article",
        "description": "Retrieve a specific news article by ID. Only returns news generated by the authenticated user.",
        "operationId": "getSingleNews",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "News article ID",
            "required": true,
            "schema": {
              "type": "string"
            },
            "example": "1234567890123456789"
          }
        ],
        "responses": {
          "200": {
            "description": "News article retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetSingleNewsResponse"
                },
                "example": {
                  "news": {
                    "id": "1234567890123456789",
                    "user_id": "1234567890123456788",
                    "title": "Technology Advances in Artificial Intelligence",
                    "content": "Artificial intelligence continues to evolve rapidly, transforming industries and creating new opportunities for innovation. Recent developments in machine learning algorithms have enabled computers to process complex data more efficiently than ever before. These systems can now understand natural language, recognize patterns in images, and make predictions with remarkable accuracy. As we move forward, the integration of AI into everyday applications will continue to reshape how we work, learn, and interact with technology.",
                    "level": "intermediate",
                    "keywords": ["technology", "artificial", "intelligence", "innovation", "machine learning"],
                    "word_in_news": ["computer", "software", "develop", "system", "technology"],
                    "source": ["Generated by AI", "Personalized Learning Content"],
                    "created_at": "2024-01-15T10:30:00Z",
                    "updated_at": "2024-01-15T10:30:00Z"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "News ID is required"
                }
              }
            }
          },
          "401": {
            "description": "User not authenticated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "User not authenticated"
                }
              }
            }
          },
          "404": {
            "description": "News article not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "News article not found"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "error": "Database error"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "News": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique news article identifier (Snowflake ID)",
            "example": "1234567890123456789"
          },
          "user_id": {
            "type": "string",
            "description": "ID of the user who generated this news",
            "example": "1234567890123456788"
          },
          "title": {
            "type": "string",
            "description": "News article title",
            "example": "Technology Advances in Artificial Intelligence"
          },
          "content": {
            "type": "string",
            "description": "Full news article content (300-500 words)",
            "example": "Artificial intelligence continues to evolve rapidly, transforming industries and creating new opportunities for innovation..."
          },
          "level": {
            "type": "string",
            "enum": ["beginner", "intermediate", "advanced"],
            "description": "Learning level of the article",
            "example": "intermediate"
          },
          "keywords": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Key topic words from the article",
            "example": ["technology", "artificial", "intelligence", "innovation"]
          },
          "word_in_news": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Vocabulary words that were sent to Gemini for incorporation (learning + review words)",
            "example": ["computer", "software", "develop", "system", "technology"]
          },
          "source": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Source information for the article",
            "example": ["Generated by AI", "Personalized Learning Content"]
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "Article creation timestamp",
            "example": "2024-01-15T10:30:00Z"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "description": "Last update timestamp",
            "example": "2024-01-15T10:30:00Z"
          }
        }
      },
      "GenerateNewsResponse": {
        "type": "object",
        "properties": {
          "all_news": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/News"
            },
            "description": "Array of all user's news articles (existing + newly generated)"
          }
        }
      },
      "GetNewsResponse": {
        "type": "object",
        "properties": {
          "news": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/News"
            },
            "description": "Array of news articles"
          },
          "total": {
            "type": "integer",
            "description": "Total number of news articles for the user",
            "example": 1
          },
          "page": {
            "type": "integer",
            "description": "Current page number",
            "example": 1
          },
          "limit": {
            "type": "integer",
            "description": "Number of items per page",
            "example": 10
          }
        }
      },
      "GetSingleNewsResponse": {
        "type": "object",
        "properties": {
          "news": {
            "$ref": "#/components/schemas/News"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "description": "Error message",
            "example": "User not authenticated"
          }
        }
      }
    },
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT token obtained from authentication endpoint"
      }
    }
  },
  "tags": [
    {
      "name": "News Generation",
      "description": "Personalized news generation endpoints using AI and user vocabulary"
    },
    {
      "name": "News Retrieval",
      "description": "News article retrieval and search endpoints"
    }
  ]
} 